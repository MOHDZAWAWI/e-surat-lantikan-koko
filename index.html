import React, { useState, useEffect, useMemo } from 'react';
import { 
  Download, 
  Trash2, 
  FileText,
  Camera
} from 'lucide-react';

const App = () => {
  const [formData, setFormData] = useState({
    jenisLaporan: 'LAPORAN AKTIVITI BADAN BERUNIFORM',
    perjumpaanKali: '',
    tarikh: '',
    hari: '',
    masa: '',
    tempat: '',
    guruHadir: Array(8).fill(''),
    hadirLelaki: '',
    totalLelaki: '',
    hadirPerempuan: '',
    totalPerempuan: '',
    nilaiSivik: '',
    aktivitiDijalankan: '',
    refleksiImpak: '',
    disediakanOleh: '',
    jawatanDisediakan: 'GURU PENASIHAT',
    disemakOleh: 'WAN MOHD SABRI BIN WAN HASSAN',
    jawatanDisemak: 'PENYELARAS BADAN BERUNIFORM',
    disahkanOleh: 'MOHAMAD BIN ALI',
    jawatanDisahkan: 'PK KOKURIKULUM'
  });

  const [images, setImages] = useState([null, null]);
  const [isGenerating, setIsGenerating] = useState(false);
  const [libStatus, setLibStatus] = useState({ jspdf: false, autotable: false });

  const schoolLogoUrl = "https://i.postimg.cc/bw5gx6Qd/LOGO_SESDI_removebg_preview.png";

  const nilaiSivikOptions = [
    "TANGGUNGJAWAB",
    "KASIH SAYANG",
    "HORMAT-MENGHORMATI",
    "KEBAHAGIAAN"
  ];

  const jenisLaporanOptions = [
    "LAPORAN AKTIVITI BADAN BERUNIFORM",
    "LAPORAN AKTIVITI KELAB DAN PERSATUAN",
    "LAPORAN AKTIVITI SUKAN DAN PERMAINAN",
    "LAPORAN AKTIVITI RUMAH SUKAN"
  ];

  const masaOptions = [
    "1.00 PM - 3.00 PM",
    "1.30 PM - 3.30 PM",
    "1.45 PM - 3.45 PM",
    "2.00 PM - 4.00 PM",
    "2.30 PM - 4.30 PM",
    "3.00 PM - 5.00 PM",
    "5.00 PM - 6.00 PM",
    "8.00 AM - 10.00 AM",
    "10.00 AM - 12.00 PM"
  ];

  const formatDateDisplay = (dateString) => {
    if (!dateString) return '-';
    const [year, month, day] = dateString.split('-');
    return `${day}/${month}/${year}`;
  };

  const getMalayDay = (dateString) => {
    if (!dateString) return '';
    const date = new Date(dateString);
    const days = ["AHAD", "ISNIN", "SELASA", "RABU", "KHAMIS", "JUMAAT", "SABTU"];
    return days[date.getDay()];
  };

  const mapPenyelarasData = (jenis) => {
    switch (jenis) {
      case "LAPORAN AKTIVITI BADAN BERUNIFORM": 
        return { nama: "WAN MOHD SABRI BIN WAN HASSAN", jawatan: "PENYELARAS BADAN BERUNIFORM" };
      case "LAPORAN AKTIVITI KELAB DAN PERSATUAN": 
        return { nama: "NOR AMIRAH BINTI ABDUL HAMID", jawatan: "PENYELARAS KELAB DAN PERSATUAN" };
      case "LAPORAN AKTIVITI SUKAN DAN PERMAINAN": 
        return { nama: "AZHAR BIN AHMAD", jawatan: "PENYELARAS SUKAN DAN PERMAINAN" };
      case "LAPORAN AKTIVITI RUMAH SUKAN": 
        return { nama: "IBRAHIM BIN MOHD ZIN", jawatan: "PENYELARAS RUMAH SUKAN" };
      default: 
        return { nama: "", jawatan: "PENYELARAS KOKURIKULUM" };
    }
  };

  const totals = useMemo(() => {
    const hL = parseInt(formData.hadirLelaki) || 0;
    const hP = parseInt(formData.hadirPerempuan) || 0;
    const tL = parseInt(formData.totalLelaki) || 0;
    const tP = parseInt(formData.totalPerempuan) || 0;
    return {
      lelaki: `${hL}/${tL}`,
      perempuan: `${hP}/${tP}`,
      jumlah: `${hL + hP}/${tL + tP}`
    };
  }, [formData]);

  const guruAktif = useMemo(() => {
    return formData.guruHadir.filter(name => name.trim() !== "");
  }, [formData.guruHadir]);

  useEffect(() => {
    const jsPdfScript = document.createElement('script');
    jsPdfScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
    jsPdfScript.async = true;
    jsPdfScript.onload = () => {
      setLibStatus(prev => ({ ...prev, jspdf: true }));
      const autoTableScript = document.createElement('script');
      autoTableScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js';
      autoTableScript.async = true;
      autoTableScript.onload = () => {
        setLibStatus(prev => ({ ...prev, autotable: true }));
      };
      document.body.appendChild(autoTableScript);
    };
    document.body.appendChild(jsPdfScript);
  }, []);

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    if (name === 'jenisLaporan') {
      const dataPenyelaras = mapPenyelarasData(value);
      setFormData(prev => ({ 
        ...prev, 
        [name]: value, 
        disemakOleh: dataPenyelaras.nama,
        jawatanDisemak: dataPenyelaras.jawatan 
      }));
    } else if (name === 'tarikh') {
      setFormData(prev => ({ ...prev, [name]: value, hari: getMalayDay(value) }));
    } else {
      setFormData(prev => ({ ...prev, [name]: value }));
    }
  };

  const getBase64FromUrl = async (url) => {
    try {
      const data = await fetch(url);
      const blob = await data.blob();
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.readAsDataURL(blob); 
        reader.onloadend = () => resolve(reader.result);
      });
    } catch (e) { return null; }
  };

  const generatePDF = async () => {
    if (!libStatus.jspdf || !libStatus.autotable) return;
    setIsGenerating(true);

    try {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
      const pageWidth = doc.internal.pageSize.getWidth();
      const margin = 15;
      let y = 8;

      const logo = await getBase64FromUrl(schoolLogoUrl);
      if (logo) {
        doc.addImage(logo, 'PNG', (pageWidth/2)-8, y, 16, 16);
        y += 20;
      }

      doc.setFont("helvetica", "bold").setFontSize(10).setTextColor(30, 58, 138);
      doc.text(formData.jenisLaporan, pageWidth/2, y, { align: 'center' });
      y += 4; 
      
      doc.setDrawColor(30, 58, 138).setLineWidth(0.5).line(margin, y, pageWidth-margin, y);
      y += 1;
      doc.setLineWidth(0.15).line(margin, y, pageWidth-margin, y);
      y += 6;

      doc.setFontSize(8.5).setTextColor(0, 0, 0);
      const drawInfo = (label, val, x, yPos, labelW = 30) => {
        doc.setFont("helvetica", "bold").text(label, x, yPos);
        doc.text(":", x + labelW, yPos);
        doc.setFont("helvetica", "normal").text(val || '-', x + labelW + 3, yPos);
      };

      drawInfo("PERJUMPAAN KALI", formData.perjumpaanKali, margin, y);
      y += 5;
      drawInfo("TARIKH", formatDateDisplay(formData.tarikh), margin, y);
      drawInfo("HARI", formData.hari, margin + 100, y, 15);
      y += 5;
      drawInfo("MASA", formData.masa, margin, y);
      drawInfo("TEMPAT", formData.tempat, margin + 100, y, 15);
      y += 7;

      doc.autoTable({
        startY: y,
        head: [['Bil.', 'Nama Guru Penasihat', 'Tandatangan']],
        body: guruAktif.length > 0 ? guruAktif.map((n, i) => [i+1, n.toUpperCase(), '']) : [['-', 'TIADA MAKLUMAT', '']],
        margin: { left: margin, right: margin },
        theme: 'grid',
        headStyles: { fillColor: [30, 58, 138], fontSize: 7.5, halign: 'center', textColor: 255 },
        styles: { fontSize: 7.5, cellPadding: 1.5, lineColor: [200, 200, 200] },
        columnStyles: { 0: { cellWidth: 8, halign: 'center' }, 2: { cellWidth: 35 } }
      });
      y = doc.lastAutoTable.finalY + 6;

      doc.setFont("helvetica", "bold").setFontSize(8).setTextColor(30, 58, 138);
      doc.text("KEHADIRAN MURID:", margin, y);
      y += 3;

      const frameW = (pageWidth - (margin * 2) - 10) / 3;
      const frameH = 12;

      const drawFrame = (title, val, x) => {
        doc.setDrawColor(30, 58, 138).setLineWidth(0.2).setFillColor(245, 247, 255);
        doc.roundedRect(x, y, frameW, frameH, 1, 1, 'FD');
        doc.setFont("helvetica", "bold").setFontSize(6.5).setTextColor(100, 100, 100);
        doc.text(title, x + (frameW/2), y + 4, { align: 'center' });
        doc.setFont("helvetica", "bold").setFontSize(9).setTextColor(30, 58, 138);
        doc.text(val, x + (frameW/2), y + 9.5, { align: 'center' });
      };

      drawFrame("LELAKI", totals.lelaki, margin);
      drawFrame("PEREMPUAN", totals.perempuan, margin + frameW + 5);
      drawFrame("JUMLAH", totals.jumlah, margin + (frameW + 5) * 2);
      
      y += frameH + 8;

      const addSection = (title, content, currentY) => {
        doc.setFont("helvetica", "bold").setFontSize(8).setTextColor(30, 58, 138);
        doc.text(title.toUpperCase() + ":", margin, currentY);
        currentY += 4;
        doc.setFont("helvetica", "normal").setFontSize(8).setTextColor(0, 0, 0);
        const lines = doc.splitTextToSize(content || '-', pageWidth - (margin*2) - 4);
        doc.text(lines, margin + 2, currentY);
        return currentY + (lines.length * 4) + 5;
      };

      y = addSection("Nilai Sivik (10 Minit)", formData.nilaiSivik, y);
      y = addSection("Aktiviti yang dijalankan", formData.aktivitiDijalankan, y);
      y = addSection("Refleksi dan Impak", formData.refleksiImpak, y);

      if (images[0] || images[1]) {
        y += 2;
        doc.setFont("helvetica", "bold").setFontSize(8).setTextColor(30, 58, 138);
        doc.text("LAMPIRAN GAMBAR AKTIVITI:", margin, y);
        y += 2;
        const imgW = (pageWidth - (margin * 2) - 8) / 2;
        const imgH = imgW * 0.6;
        
        const renderImg = (data, x) => {
          if (!data) return;
          doc.setDrawColor(220, 220, 220).setFillColor(250, 250, 250);
          doc.roundedRect(x, y, imgW, imgH, 1, 1, 'FD');
          doc.addImage(data, 'JPEG', x + 1, y + 1, imgW - 2, imgH - 2);
        };
        renderImg(images[0], margin);
        renderImg(images[1], margin + imgW + 8);
      }

      const sigY = doc.internal.pageSize.getHeight() - 35;
      const colW = (pageWidth - (margin*2)) / 3;
      const drawSig = (label, name, jawatan, x) => {
        doc.setFont("helvetica", "normal").setFontSize(7).setTextColor(0,0,0);
        doc.text(label, x, sigY);
        doc.line(x, sigY + 12, x + colW - 5, sigY + 12);
        doc.setFont("helvetica", "bold").text(name ? `(${name.toUpperCase()})` : "(...........................................)", x, sigY + 16);
        doc.setFont("helvetica", "normal").setFontSize(6).text(jawatan, x, sigY + 19.5, { maxWidth: colW - 5 });
      };

      drawSig("Disediakan oleh,", formData.disediakanOleh, formData.jawatanDisediakan, margin);
      drawSig("Disemak oleh,", formData.disemakOleh, formData.jawatanDisemak, margin + colW);
      drawSig("Disahkan oleh,", formData.disahkanOleh, formData.jawatanDisahkan, margin + (colW*2));

      doc.save(`Laporan_Koku_${formData.tarikh || 'Baru'}.pdf`);
    } catch (e) { console.error(e); } finally { setIsGenerating(false); }
  };

  return (
    <div className="min-h-screen bg-slate-50 py-10 px-4 flex flex-col items-center font-sans text-slate-900">
      <div className="w-full max-w-7xl grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        {/* Bahagian Borang Input */}
        <div className="lg:col-span-5 flex flex-col gap-6">
          <div className="bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden">
            {/* Header dengan Gradient & Logo Berbingkai Ikut Bentuk */}
            <header className="bg-gradient-to-br from-blue-700 via-blue-900 to-indigo-900 p-8 text-white flex flex-col items-center gap-4 relative overflow-hidden">
              <div className="absolute top-0 right-0 w-48 h-48 bg-white/5 rounded-full -mr-24 -mt-24 blur-3xl"></div>
              
              <div className="relative z-10">
                {/* Logo dengan Drop Shadow Putih (Bingkai Ikut Bentuk) */}
                <img 
                  src={schoolLogoUrl} 
                  alt="Logo Sekolah" 
                  className="w-24 h-24 object-contain transition-transform hover:scale-110 duration-300"
                  style={{ 
                    filter: 'drop-shadow(2px 2px 0 white) drop-shadow(-2px -2px 0 white) drop-shadow(2px -2px 0 white) drop-shadow(-2px 2px 0 white)' 
                  }} 
                />
              </div>
              
              <div className="text-center z-10 mt-2">
                <h1 className="font-extrabold uppercase tracking-widest text-base drop-shadow-md">
                  LAPORAN AKTIVITI KOKURIKULUM SESDI
                </h1>
                <div className="h-1 w-12 bg-yellow-400 mx-auto mt-2 rounded-full"></div>
              </div>
            </header>

            <div className="p-6 space-y-6 max-h-[65vh] overflow-y-auto custom-scrollbar">
              <div className="space-y-4">
                <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Maklumat Asas</label>
                <select name="jenisLaporan" value={formData.jenisLaporan} onChange={handleInputChange} className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-semibold focus:ring-2 focus:ring-blue-500 outline-none">
                  {jenisLaporanOptions.map((o, i) => <option key={i} value={o}>{o}</option>)}
                </select>
                <div className="grid grid-cols-2 gap-4">
                  <div className="space-y-1">
                    <span className="text-[9px] font-bold text-slate-400 uppercase">Bil. Perjumpaan</span>
                    <input type="text" name="perjumpaanKali" placeholder="CONTOH: 1" value={formData.perjumpaanKali} onChange={handleInputChange} className="w-full p-3 border rounded-xl text-sm focus:ring-2 focus:ring-blue-500" />
                  </div>
                  <div className="space-y-1">
                    <span className="text-[9px] font-bold text-slate-400 uppercase">Tarikh</span>
                    <input type="date" name="tarikh" value={formData.tarikh} onChange={handleInputChange} className="w-full p-3 border rounded-xl text-sm focus:ring-2 focus:ring-blue-500" />
                  </div>
                </div>
                <div className="grid grid-cols-2 gap-4">
                  <div className="space-y-1">
                    <span className="text-[9px] font-bold text-slate-400 uppercase">Hari</span>
                    <input type="text" name="hari" value={formData.hari} readOnly placeholder="AUTO" className="w-full p-3 border rounded-xl text-sm bg-blue-50/50 font-bold text-blue-900 border-blue-100" />
                  </div>
                  <div className="space-y-1">
                    <span className="text-[9px] font-bold text-slate-400 uppercase">Masa</span>
                    <select name="masa" value={formData.masa} onChange={handleInputChange} className="w-full p-3 border rounded-xl text-sm bg-white focus:ring-2 focus:ring-blue-500">
                      <option value="">-- PILIH MASA --</option>
                      {masaOptions.map(m => <option key={m} value={m}>{m}</option>)}
                    </select>
                  </div>
                </div>
                <div className="space-y-1">
                  <span className="text-[9px] font-bold text-slate-400 uppercase">Tempat</span>
                  <input type="text" name="tempat" placeholder="LOKASI AKTIVITI" value={formData.tempat} onChange={handleInputChange} className="w-full p-3 border rounded-xl text-sm focus:ring-2 focus:ring-blue-500" />
                </div>
              </div>

              <div className="space-y-4 pt-4 border-t">
                <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Guru Penasihat</label>
                <div className="grid grid-cols-2 gap-2">
                  {formData.guruHadir.map((g, i) => (
                    <input key={i} type="text" placeholder={`NAMA GURU ${i+1}`} value={g} onChange={(e) => {
                      const updated = [...formData.guruHadir];
                      updated[i] = e.target.value;
                      setFormData(prev => ({ ...prev, guruHadir: updated }));
                    }} className="p-2 border rounded-lg text-xs uppercase focus:ring-1 focus:ring-blue-500 outline-none" />
                  ))}
                </div>
              </div>

              <div className="space-y-4 pt-4 border-t">
                 <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Kehadiran Murid</label>
                 <div className="grid grid-cols-2 gap-4 bg-blue-50/50 p-4 rounded-2xl border border-blue-100">
                  <div>
                    <span className="text-[9px] font-bold block mb-1 uppercase text-blue-700">Lelaki (Hadir/Total)</span>
                    <div className="flex gap-1">
                      <input type="number" name="hadirLelaki" placeholder="0" value={formData.hadirLelaki} onChange={handleInputChange} className="w-1/2 p-2 text-xs border rounded-lg" />
                      <input type="number" name="totalLelaki" placeholder="0" value={formData.totalLelaki} onChange={handleInputChange} className="w-1/2 p-2 text-xs border rounded-lg" />
                    </div>
                  </div>
                  <div>
                    <span className="text-[9px] font-bold block mb-1 uppercase text-blue-700">Perempuan (Hadir/Total)</span>
                    <div className="flex gap-1">
                      <input type="number" name="hadirPerempuan" placeholder="0" value={formData.hadirPerempuan} onChange={handleInputChange} className="w-1/2 p-2 text-xs border rounded-lg" />
                      <input type="number" name="totalPerempuan" placeholder="0" value={formData.totalPerempuan} onChange={handleInputChange} className="w-1/2 p-2 text-xs border rounded-lg" />
                    </div>
                  </div>
                </div>
              </div>

              <div className="space-y-4 pt-4 border-t">
                <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Intipati Aktiviti</label>
                <div className="space-y-1">
                  <span className="text-[9px] font-bold text-slate-400 uppercase">Nilai Sivik (10 Minit)</span>
                  <select name="nilaiSivik" value={formData.nilaiSivik} onChange={handleInputChange} className="w-full p-3 border rounded-xl text-sm bg-white outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">-- PILIH NILAI SIVIK --</option>
                    {nilaiSivikOptions.map(option => (
                      <option key={option} value={option}>{option}</option>
                    ))}
                  </select>
                </div>
                <div className="space-y-1">
                  <span className="text-[9px] font-bold text-slate-400 uppercase">Ringkasan Aktiviti</span>
                  <textarea name="aktivitiDijalankan" placeholder="TERANGKAN AKTIVITI YANG DIJALANKAN..." value={formData.aktivitiDijalankan} onChange={handleInputChange} className="w-full p-3 border rounded-xl text-sm h-24 focus:ring-2 focus:ring-blue-500 outline-none" />
                </div>
                <div className="space-y-1">
                  <span className="text-[9px] font-bold text-slate-400 uppercase">Refleksi & Impak</span>
                  <textarea name="refleksiImpak" placeholder="KEBERKESANAN AKTIVITI..." value={formData.refleksiImpak} onChange={handleInputChange} className="w-full p-3 border rounded-xl text-sm h-24 focus:ring-2 focus:ring-blue-500 outline-none" />
                </div>
              </div>

              <div className="space-y-4 pt-4 border-t">
                <label className="text-[10px] font-bold text-slate-400 uppercase flex items-center gap-2 tracking-widest"><Camera className="w-4 h-4 text-blue-600"/> Gambar Lampiran</label>
                <div className="grid grid-cols-2 gap-4">
                  {[0, 1].map((idx) => (
                    <div key={idx} className="relative aspect-[4/3] border-2 border-dashed rounded-2xl flex items-center justify-center overflow-hidden bg-slate-50 hover:bg-slate-100 transition-colors group">
                      {images[idx] ? (
                        <div className="w-full h-full relative">
                          <img src={images[idx]} className="w-full h-full object-cover" alt="Lampiran" />
                          <button onClick={() => { const n = [...images]; n[idx] = null; setImages(n); }} className="absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full shadow-lg hover:bg-red-600 transform scale-0 group-hover:scale-100 transition-transform"><Trash2 className="w-3 h-3"/></button>
                        </div>
                      ) : (
                        <div className="flex flex-col items-center gap-2 pointer-events-none">
                          <input type="file" accept="image/*" onChange={(e) => {
                            const file = e.target.files[0];
                            if (file) {
                              const r = new FileReader();
                              r.onload = (ev) => { const n = [...images]; n[idx] = ev.target.result; setImages(n); };
                              r.readAsDataURL(file);
                            }
                          }} className="absolute inset-0 opacity-0 cursor-pointer pointer-events-auto" />
                          <Camera className="text-slate-300 w-10 h-10 group-hover:text-blue-200 transition-colors"/>
                          <span className="text-[9px] text-slate-400 font-black">MUAT NAIK</span>
                        </div>
                      )}
                    </div>
                  ))}
                </div>
              </div>

              <div className="space-y-4 pt-4 border-t">
                <div className="space-y-1">
                  <span className="text-[9px] font-bold text-slate-400 uppercase">Disediakan Oleh</span>
                  <input type="text" name="disediakanOleh" placeholder="NAMA PENUH ANDA" value={formData.disediakanOleh} onChange={handleInputChange} className="w-full p-3 border rounded-xl text-sm uppercase focus:ring-2 focus:ring-blue-500" />
                </div>
              </div>
            </div>

            <div className="p-6 bg-slate-50 border-t">
              <button onClick={generatePDF} disabled={isGenerating || !libStatus.jspdf} className="w-full bg-gradient-to-r from-blue-900 to-indigo-900 text-white py-4 rounded-2xl font-bold flex items-center justify-center gap-3 hover:shadow-xl disabled:bg-slate-400 disabled:from-slate-400 disabled:to-slate-400 transition-all active:scale-95">
                {isGenerating ? "MENGUPAS DATA..." : <><Download className="w-5 h-5"/> JANAKAN LAPORAN PDF</>}
              </button>
            </div>
          </div>
        </div>

        {/* Bahagian Preview Dokumen */}
        <div className="lg:col-span-7 flex flex-col items-center">
          <div className="bg-white shadow-2xl w-full max-w-[210mm] aspect-[1/1.414] p-[12mm] text-[9pt] flex flex-col border border-slate-300 overflow-hidden relative">
            
            <div className="flex flex-col items-center mb-6">
              <img src={schoolLogoUrl} className="w-16 h-16 object-contain mb-3" alt="Logo" />
              <h2 className="font-bold text-center uppercase text-blue-900 text-[10pt] tracking-tight leading-tight">{formData.jenisLaporan}</h2>
              <div className="w-full h-[1.5pt] bg-blue-900 mt-3"></div>
              <div className="w-full h-[0.5pt] bg-blue-900 mt-[1pt]"></div>
            </div>

            <div className="grid grid-cols-1 gap-1 mb-4">
              <div className="flex text-[8.5pt]"><span className="w-36 font-bold uppercase text-slate-500">Perjumpaan Kali</span><span className="mr-3">:</span><span className="font-bold">{formData.perjumpaanKali || '-'}</span></div>
              <div className="flex text-[8.5pt] justify-between">
                <div className="flex flex-1"><span className="w-36 font-bold uppercase text-slate-500">Tarikh / Hari</span><span className="mr-3">:</span><span className="font-medium">{formatDateDisplay(formData.tarikh)} ({formData.hari || '-'})</span></div>
                <div className="flex w-1/3"><span className="w-16 font-bold uppercase text-slate-500">Masa</span><span className="mr-3">:</span><span>{formData.masa || '-'}</span></div>
              </div>
              <div className="flex text-[8.5pt]"><span className="w-36 font-bold uppercase text-slate-500">Tempat</span><span className="mr-3">:</span><span>{formData.tempat || '-'}</span></div>
            </div>

            <table className="w-full border-collapse mb-5">
              <thead>
                <tr className="bg-blue-900 text-white text-[7.5pt]">
                  <th className="border-2 border-blue-900 p-1.5 w-10 uppercase">Bil.</th>
                  <th className="border-2 border-blue-900 p-1.5 text-left pl-3 uppercase">Nama Guru Penasihat</th>
                  <th className="border-2 border-blue-900 p-1.5 w-32 uppercase">Tandatangan</th>
                </tr>
              </thead>
              <tbody>
                {guruAktif.length > 0 ? guruAktif.map((n, i) => (
                  <tr key={i} className="text-[7.5pt] border-b border-slate-200">
                    <td className="border-x border-slate-200 p-1.5 text-center font-bold text-blue-800">{i+1}</td>
                    <td className="border-x border-slate-200 p-1.5 pl-3 uppercase font-medium">{n}</td>
                    <td className="border-x border-slate-200 p-1.5"></td>
                  </tr>
                )) : (
                  <tr><td colSpan="3" className="border p-4 text-center text-slate-300 italic">Maklumat guru tidak diisi</td></tr>
                )}
              </tbody>
            </table>

            <h4 className="font-bold text-blue-900 uppercase text-[7.5pt] mb-2 px-1 text-left">Kehadiran Murid:</h4>
            <div className="grid grid-cols-3 gap-4 mb-6">
              {[
                { label: 'LELAKI', val: totals.lelaki },
                { label: 'PEREMPUAN', val: totals.perempuan },
                { label: 'JUMLAH', val: totals.jumlah }
              ].map((item, i) => (
                <div key={i} className="border-2 border-blue-100 bg-blue-50/50 rounded-xl p-2 flex flex-col items-center">
                  <span className="text-[6.5pt] font-bold text-slate-400">{item.label}</span>
                  <span className="text-[11pt] font-black text-blue-900">{item.val}</span>
                </div>
              ))}
            </div>

            <div className="space-y-4 mb-6">
              <div><h4 className="font-bold text-blue-900 uppercase text-[7.5pt] mb-1 flex items-center gap-2">Nilai Sivik (10 Minit):</h4><p className="text-slate-600 pl-4 italic text-[8pt] border-l-2 border-blue-100">{formData.nilaiSivik || '-'}</p></div>
              <div><h4 className="font-bold text-blue-900 uppercase text-[7.5pt] mb-1">Aktiviti Dijalankan:</h4><p className="pl-4 text-[8pt] border-l-2 border-blue-100 leading-relaxed text-slate-700">{formData.aktivitiDijalankan || '-'}</p></div>
              <div><h4 className="font-bold text-blue-900 uppercase text-[7.5pt] mb-1">Refleksi / Impak:</h4><p className="pl-4 text-[8pt] border-l-2 border-blue-100 text-slate-700">{formData.refleksiImpak || '-'}</p></div>
            </div>

            <div className="grid grid-cols-2 gap-4 mt-auto mb-10">
              {images.map((img, i) => img && (
                <div key={i} className="flex flex-col items-center gap-1">
                  <div className="w-full aspect-[4/2.5] p-1 bg-white border-2 border-slate-100 rounded-xl shadow-sm overflow-hidden">
                    <img src={img} className="w-full h-full object-cover" alt={`Lampiran ${i+1}`} />
                  </div>
                  <span className="text-[6pt] text-slate-400 font-bold uppercase">Gambar {i+1}</span>
                </div>
              ))}
            </div>

            <div className="grid grid-cols-3 gap-6 pt-6 border-t border-slate-100">
              {[
                { label: 'Disediakan oleh,', name: formData.disediakanOleh, jawatan: formData.jawatanDisediakan },
                { label: 'Disemak oleh,', name: formData.disemakOleh, jawatan: formData.jawatanDisemak },
                { label: 'Disahkan oleh,', name: formData.disahkanOleh, jawatan: formData.jawatanDisahkan }
              ].map((sig, i) => (
                <div key={i} className="flex flex-col text-left">
                  <span className="mb-10 text-[7pt] text-slate-500">{sig.label}</span>
                  <div className="h-[0.5pt] bg-slate-400 mb-1 w-full"></div>
                  <span className="font-bold uppercase text-[7pt] text-blue-950">({sig.name || '..........................'})</span>
                  <span className="text-[6pt] text-slate-400 font-medium leading-tight">{sig.jawatan}</span>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
      <style>{`
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
      `}</style>
    </div>
  );
};

export default App;